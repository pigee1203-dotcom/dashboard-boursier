<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dashboard Boursier Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial/dist/chartjs-chart-financial.min.js"></script>
<style>
    body { font-family: 'Roboto', sans-serif; background:#f0f2f5; color:#333; margin:0; padding:0; }
    h1 { text-align:center; margin:20px 0; color:#1a1f36; }
    .container { width:90%; max-width:900px; margin:auto; }
    .section { background:#fff; border-radius:12px; padding:20px; margin:20px 0; box-shadow:0 4px 12px rgba(0,0,0,0.08); transition:0.3s; }
    .section:hover { box-shadow:0 6px 16px rgba(0,0,0,0.12); }
    .ticker, .alert-item { display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px solid #eee; }
    .ticker:last-child, .alert-item:last-child { border-bottom:none; }
    button { cursor:pointer; background:#4a6cf7; color:#fff; border:none; padding:6px 12px; border-radius:6px; font-weight:500; transition:0.2s; }
    button:hover { background:#3b55d1; }
    input, select { padding:6px 10px; border-radius:6px; border:1px solid #ccc; margin-right:5px; }
    #chart { width:100%; height:350px; }
    .mode-box { border-radius:10px; padding:15px; margin:10px 0; background:#f9f9fb; box-shadow:0 2px 6px rgba(0,0,0,0.05); transition:0.3s; }
    .mode-box.warning { background:#ffe5e5; }
    .price-up { color:green; transition:0.3s; }
    .price-down { color:red; transition:0.3s; }
    .popular-tickers { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px; }
    .popular-tickers button { font-size:14px; padding:4px 8px; }
    #mode-switch { text-align:center; margin:20px 0; }
</style>
</head>
<body>
<h1>Dashboard Boursier Pro</h1>
<div class="container">

<!-- Tickers populaires -->
<div class="section">
    <h2>Tickers Populaires</h2>
    <div class="popular-tickers">
        <button onclick="addTickerFromPopular('AAPL')">AAPL üçè</button>
        <button onclick="addTickerFromPopular('TSLA')">TSLA üöó</button>
        <button onclick="addTickerFromPopular('NVDA')">NVDA üíª</button>
        <button onclick="addTickerFromPopular('MSFT')">MSFT ü™ü</button>
        <button onclick="addTickerFromPopular('GOOGL')">GOOGL üåê</button>
        <button onclick="addTickerFromPopular('AMZN')">AMZN üì¶</button>
    </div>
    <input type="text" placeholder="Ajouter un ticker..." id="new-ticker" list="tickers-list">
    <datalist id="tickers-list">
        <option value="AAPL"><option value="TSLA"><option value="NVDA"><option value="MSFT">
        <option value="GOOGL"><option value="AMZN"><option value="META">
    </datalist>
    <button onclick="addTicker()">Ajouter</button>
</div>

<!-- Watchlist -->
<div class="section">
    <h2>Watchlist</h2>
    <div id="watchlist"></div>
</div>

<!-- Graphique -->
<div class="section">
    <h2>Graphique</h2>
    <canvas id="chart"></canvas>
    <div style="text-align:center; margin-top:10px;">
        <button onclick="toggleChartType()">Changer Graphique</button>
        <button onclick="startRealTimeChart(currentTicker)">Temps R√©el</button>
    </div>
</div>

<!-- Mode D√©butant -->
<div class="section" id="mode-debutant">
    <h2>Mode D√©butant</h2>
    <div class="mode-box"><strong>Prix actuel :</strong> <span id="prix-debutant">--</span></div>
    <div class="mode-box"><strong>RSI simplifi√© :</strong> <span id="rsi-simplifie">--</span></div>
    <div class="mode-box"><strong>Conseil :</strong> <span id="conseil-debutant">--</span></div>
    <div class="mode-box warning"><strong>Risque :</strong> <span id="risque-simple">--</span></div>
</div>

<!-- Alertes -->
<div class="section">
    <h2>Alertes</h2>
    <input type="text" placeholder="Ticker" id="alert-ticker">
    <input type="number" placeholder="Prix" id="alert-price">
    <select id="alert-direction">
        <option value="above">Au-dessus</option>
        <option value="below">En-dessous</option>
    </select>
    <button onclick="addAlert()">Cr√©er alerte</button>
    <div id="alerts"></div>
</div>

</div>

<script>
const PROXY = 'https://api.allorigins.win/raw?url=';
const API_QUOTE = ticker => `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${encodeURIComponent(ticker)}`;
const API_CHART = ticker => `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?range=1mo&interval=1d`;
const alertSound = new Audio('beep.mp3');

let state = { watchlist:['AAPL','TSLA','NVDA'], alerts:[] };
let chartInstance=null; let chartType='line'; let currentTicker=''; let intervalId=null;

// Watchlist
async function updateWatchlistUI(){
    const cont = document.getElementById('watchlist'); cont.innerHTML='';
    for(const t of state.watchlist){
        let price=null;
        try{
            const res=await fetch(PROXY+encodeURIComponent(API_QUOTE(t)));
            const data=await res.json();
            const quote=data.quoteResponse.result[0];
            if(quote && quote.regularMarketPrice!=null) price=quote.regularMarketPrice;
        }catch(e){ console.warn('Erreur fetch price', e); }
        const prevPrice=document.getElementById(`price-${t}`)?.dataset.value;
        const div=document.createElement('div'); div.className='ticker';
        let colorClass='';
        if(prevPrice && price){
            colorClass = price>parseFloat(prevPrice)?'price-up':'price-down';
        }
        div.innerHTML=`${t}: <span id="price-${t}" data-value="${price}" class="${colorClass}">${price!=null?price.toFixed(2)+' ‚Ç¨':'--'}</span> 
        <button onclick="startRealTimeChart('${t}')">Voir</button>`;
        cont.appendChild(div);
    }
}

// Ajouter ticker
function addTicker(){
    const input=document.getElementById('new-ticker');
    const t=input.value.trim().toUpperCase();
    if(!t) return alert('Ticker vide');
    if(!state.watchlist.includes(t)) state.watchlist.push(t);
    input.value=''; updateWatchlistUI();
}
function addTickerFromPopular(t){ if(!state.watchlist.includes(t)) state.watchlist.push(t); updateWatchlistUI(); }

// Graphique
async function viewChart(ticker){
    if(!ticker) return;
    try{
        const res=await fetch(PROXY+encodeURIComponent(API_CHART(ticker)));
        const data=await res.json();
        const result=data.chart.result[0];
        const timestamps=result.timestamp;
        const labels=timestamps.map(ts=>new Date(ts*1000).toLocaleDateString());
        const ctx=document.getElementById('chart').getContext('2d');
        if(chartInstance) chartInstance.destroy(); currentTicker=ticker;

        if(chartType==='line'){
            const closes=result.indicators.quote[0].close;
            chartInstance=new Chart(ctx,{
                type:'line',
                data:{labels:labels,datasets:[{label:ticker,data:closes,borderColor:'#4a6cf7',backgroundColor:'rgba(74,108,247,0.2)',tension:0.25,pointRadius:3} ] },
                options:{plugins:{legend:{position:'bottom'}},scales:{x:{display:true},y:{display:true}}}
            });
            updateDebutantView(ticker, closes[closes.length-1], Math.floor(Math.random()*100));
        } else {
            const ohlc=result.indicators.quote[0].open.map((o,i)=>({x:labels[i],o:o,h:result.indicators.quote[0].high[i],l:result.indicators.quote[0].low[i],c:result.indicators.quote[0].close[i]}));
            chartInstance=new Chart(ctx,{
                type:'candlestick',
                data:{datasets:[{label:ticker,data:ohlc}]},
                options:{plugins:{legend:{position:'bottom'}},scales:{x:{display:true}},y:{display:true}}
            });
        }
    }catch(e){ console.warn('Erreur graphique', e); }
}

function toggleChartType(){ chartType = chartType==='line'?'candlestick':'line'; if(currentTicker) viewChart(currentTicker); }
function startRealTimeChart(ticker){ viewChart(ticker); if(intervalId) clearInterval(intervalId); intervalId=setInterval(()=>{ viewChart(ticker); updateWatchlistUI(); },5000); }

// Alertes
function renderAlerts(){ const el=document.getElementById('alerts'); el.innerHTML=''; state.alerts.forEach((a,i)=>{ const div=document.createElement('div'); div.className='alert-item'; div.innerHTML=`${a.ticker} ${a.direction==='above'?'>':'<'} ${a.price} <button onclick="removeAlert(${i})">Supprimer</button>`; el.appendChild(div); }); }
function addAlert(){ const t=document.getElementById('alert-ticker').value.trim().toUpperCase(); const p=parseFloat(document.getElementById('alert-price').value); const d=document.getElementById('alert-direction').value; if(!t||!p) return alert('Ticker ou prix manquant'); state.alerts.push({ticker:t,price:p,direction:d}); document.getElementById('alert-ticker').value=''; document.getElementById('alert-price').value=''; renderAlerts(); }
function removeAlert(i){ state.alerts.splice(i,1); renderAlerts(); }
async function checkAlerts(){ for(let a of state.alerts){ try{ const res=await fetch(PROXY+encodeURIComponent(API_QUOTE(a.ticker))); const data=await res.json(); const quote=data.quoteResponse.result[0]; const price=quote?.regularMarketPrice; if(!price) continue; if(a.direction==='above'&&price>=a.price){ alert(`ALERTE: ${a.ticker} est au-dessus de ${a.price} (actuel: ${price})`); alertSound.play(); } if(a.direction==='below'&&price<=a.price){ alert(`ALERTE: ${a.ticker} est en-dessous de ${a.price} (actuel: ${price})`); alertSound.play(); } }catch(e){ console.warn('Erreur check alert', e); } } }
setInterval(checkAlerts,30000);

// Mode D√©butant
function updateDebutantView(ticker,price,rsiValue){
    document.getElementById("prix-debutant").textContent = ticker+" : "+price.toFixed(2)+" ‚Ç¨";
    let rsiText="RSI : "+rsiValue; if(rsiValue>70) rsiText+=" (surachet√©)"; else if(rsiValue<30) rsiText+=" (survendu)"; else rsiText+=" (zone neutre)";
    document.getElementById("rsi-simplifie").textContent = rsiText;
    let conseil="Analyse en cours..."; if(rsiValue>70) conseil="Attention : le prix est peut-√™tre trop haut."; if(rsiValue<30) conseil="Peut-√™tre une opportunit√© pour entrer."; if(rsiValue>=30 && rsiValue<=70) conseil="March√© stable.";
    document.getElementById("conseil-debutant").textContent = conseil;
    let risque="Aucun danger imm√©diat."; if(rsiValue>80) risque="‚ö† Risque √©lev√© : chute possible."; if(rsiValue<20) risque="‚ö† Risque : march√© tr√®s incertain.";
    document.getElementById("risque-simple").textContent = risque;
}

// Mode D√©butant/Pro
function setMode(mode){ document.getElementById('mode-debutant').style.display = mode==='debutant'?'block':'none'; document.getElementById('section-debutant').style.display = mode==='debutant'?'block':'none'; }

// Init
updateWatchlistUI(); renderAlerts();
</script>
</body>
</html>
